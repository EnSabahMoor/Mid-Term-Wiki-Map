<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WIKI MAP</title>

    <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
    <script type="text/javascript" src="/scripts/app.js"></script>

    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 50%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

  </head>

  <body>

      <section>
        <!-- <form method="GET" action="/maps"> -->
          <button class= "toronto">Best Restaurants in Toronto</button>
        <!-- </form> -->
      </section>


      <form>
        Title<br>
        <input type="text" name="title"><br>
        Last name:<br>
        <input type="text" name="Description">
        <input type="submit" value="Submit">
      </form>




      <form class="newmap" action="api/users/4/maps" method="POST">
        Map Title:<input name='map-title'>
        <button class='toCreateMap' type="submit">CREATE MAP</button>
      </form>

       <div id="map">


       </div>
    <script>

      let markersCoord = [];

      var map;
      var locationToronto = {lat: 43.6532, lng: -79.3832};
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: locationToronto,
          zoom: 12,
          zoomControl: true,
          mapTypeControl: true,
          scaleControl: true,
          streetViewControl: true,
          rotateControl: true,
          fullscreenControl: true
        });

// To add a marker by default on the page
         // var marker = new google.maps.Marker({
         //   position: map.center,
         //   map: map
         // });
         // map.panTo(marker.position);

         // var latMarker = marker.getPosition().lat();
         // var lngMarker = marker.getPosition().lng();


//To get the coordinates of the canter of the map location

         var lat = map.getCenter().lat();
         var lng =  map.getCenter().lng();


         // console.log("Map:", lat, lng);


// This is the event hanlder to Creat the map. It will basically send the map details and the coordinates etc on the map

         // console.log("Map:", lat, lng, "Marker:", latMarker, lngMarker );


        $(() => {
          $(".newmap").on('submit', function (event){


              let mapObject = {lat, lng};
              let title = $(this).serialize();
              title = title.slice(10);

              $.ajax({
                method: "POST",
                url: `api/users/4/maps`,
                data: {title, mapObject, markersCoord}
              }).done((map) => {
                  console.log(map, " SUCCESS");
              });
              event.preventDefault();
            });

        });

// to get marker location and console log the lat and lng

        var icon = "http://maps.google.com/mapfiles/kml/pal2/icon32.png";

        google.maps.event.addListener(map, 'click', function(event) {


         placeMarker(event.latLng);

        });

        function placeMarker(location) {
            // var markerLabel='GO!';
            // var markerIcon = {
            //               url: 'http://image.flaticon.com/icons/svg/252/252025.svg',
            //               scaledSize: new google.maps.Size(80, 80),
            //               origin: new google.maps.Point(0, 0),
            //               anchor: new google.maps.Point(32,65)
            //             };


            var markerNew = new google.maps.Marker({
            position: location,
            animation: google.maps.Animation.DROP,
            map: map,
            icon: icon,
            // label: markerLabel
             });

            var latMarkerNew = markerNew.getPosition().lat();
            var lngMarkerNew = markerNew.getPosition().lng();
            // console.log("Marker:", latMarkerNew, lngMarkerNew );


             var contentString =
            '<img src="http://maps.google.com/mapfiles/kml/pal2/icon32.png">'+'<p><b>Title:</b> No.1</form>'+'<div id="bodyContent">'+
            '<p><b>Description:</b>'+'The best restaurant in Toronto</p>'+
            '</div>';



            console.log(latMarkerNew, lngMarkerNew);

            var infowindow = new google.maps.InfoWindow({
              content: contentString,
              maxWidth: 200
            });


            markerNew.addListener('click', function() {
              infowindow.open(map, markerNew);
            });

            let coordObject = {latMarkerNew, lngMarkerNew}
            markersCoord.push(coordObject);
            // console.log(markersCoord);
    }

 }


    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtXOaqqDPKHhH2X8Oog8vYdwmqrQn7Lpc&callback=initMap"
    async defer>

    </script>




  </body>
  <footer>

  </footer>
</html>
